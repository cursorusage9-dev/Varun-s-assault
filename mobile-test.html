<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ff0000">
    <title>Mobile Test - Varun's Assault</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            background: linear-gradient(135deg, #0a0000 0%, #1a0000 50%, #2d0000 100%);
            font-family: 'Arial', sans-serif;
            color: #ff0000;
            overflow: hidden;
            position: relative;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(10, 0, 0, 0.9);
            border-bottom: 2px solid #ff0000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            z-index: 10;
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }

        .stats {
            display: flex;
            gap: 15px;
            font-size: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff4500;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }

        .game-canvas-container {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(10, 0, 0, 0.95);
            border: 2px solid #ff0000;
        }

        #game-canvas {
            border: 2px solid #ff0000;
            border-radius: 8px;
            background: rgba(10, 0, 0, 0.95);
            outline: none;
            cursor: text;
            display: block;
            visibility: visible;
            opacity: 1;
        }

        .debug-info {
            position: absolute;
            top: 70px;
            left: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 5px;
            font-size: 12px;
            border-radius: 3px;
            z-index: 10000;
        }

        .mobile-keyboard-trigger {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }

        /* Mobile specific styles */
        @media (max-width: 768px) {
            .header {
                height: 50px;
                padding: 0 10px;
            }

            .game-title {
                font-size: 1.2rem;
            }

            .stats {
                gap: 10px;
                font-size: 0.9rem;
            }

            .stat-value {
                font-size: 1rem;
            }

            .game-canvas-container {
                top: 50px;
            }

            #game-canvas {
                width: 100% !important;
                height: 100% !important;
                max-width: 100vw !important;
                max-height: calc(100vh - 50px) !important;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header class="header">
            <h1 class="game-title">Mobile Test</h1>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="score">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="lives">3</div>
                    <div class="stat-label">Lives</div>
                </div>
            </div>
        </header>

        <div class="game-canvas-container">
            <canvas id="game-canvas" tabindex="1"></canvas>
            <input type="text" id="mobile-keyboard-trigger" class="mobile-keyboard-trigger" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            <div class="debug-info" id="debug-info">Mobile Test Ready</div>
        </div>
    </div>

    <script>
        class MobileGameTest {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.keyboardTrigger = document.getElementById('mobile-keyboard-trigger');
                this.debugInfo = document.getElementById('debug-info');
                
                this.score = 0;
                this.level = 1;
                this.lives = 3;
                
                this.words = ['HELLO', 'WORLD', 'GAME', 'TEST', 'MOBILE', 'TYPING', 'SHOOT', 'PLAY'];
                this.activeWords = [];
                this.typedText = '';
                
                this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                this.init();
            }

            init() {
                console.log('ðŸŽ® Mobile Game Test Initializing...');
                this.setupCanvas();
                this.setupEvents();
                this.startGame();
                this.updateDebugInfo('Game Started');
            }

            setupCanvas() {
                const container = document.querySelector('.game-canvas-container');
                const containerRect = container.getBoundingClientRect();
                
                // Set canvas size
                this.canvas.width = containerRect.width;
                this.canvas.height = containerRect.height;
                this.canvas.style.width = containerRect.width + 'px';
                this.canvas.style.height = containerRect.height + 'px';
                
                console.log('ðŸŽ® Canvas size:', containerRect.width + 'x' + containerRect.height);
                
                // Force visibility
                this.canvas.style.display = 'block';
                this.canvas.style.visibility = 'visible';
                this.canvas.style.opacity = '1';
                
                // Make canvas focusable
                this.canvas.setAttribute('tabindex', '1');
            }

            setupEvents() {
                // Keyboard events
                this.keyboardTrigger.addEventListener('input', (e) => {
                    this.handleInput(e.target.value);
                    e.target.value = '';
                });

                // Canvas focus events
                this.canvas.addEventListener('focus', () => {
                    if (this.isMobile) {
                        this.keyboardTrigger.focus();
                    }
                });

                this.canvas.addEventListener('click', () => {
                    this.canvas.focus();
                    if (this.isMobile) {
                        this.keyboardTrigger.focus();
                    }
                });

                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.canvas.focus();
                    if (this.isMobile) {
                        this.keyboardTrigger.focus();
                    }
                }, { passive: false });

                // Handle keyboard input
                document.addEventListener('keydown', (e) => {
                    if (e.key.length === 1) {
                        this.typedText += e.key.toUpperCase();
                        this.checkWords();
                    } else if (e.key === 'Backspace') {
                        this.typedText = this.typedText.slice(0, -1);
                    } else if (e.key === 'Enter') {
                        this.typedText = '';
                    }
                    this.render();
                });
            }

            handleInput(input) {
                if (input.length > 0) {
                    this.typedText += input.toUpperCase();
                    this.checkWords();
                    this.render();
                }
            }

            checkWords() {
                for (let i = this.activeWords.length - 1; i >= 0; i--) {
                    const word = this.activeWords[i];
                    if (this.typedText.includes(word.text)) {
                        // Word completed!
                        this.score += word.text.length * 10;
                        this.activeWords.splice(i, 1);
                        this.typedText = this.typedText.replace(word.text, '');
                        this.updateStats();
                        this.updateDebugInfo(`Hit: ${word.text} (+${word.text.length * 10})`);
                    }
                }
            }

            startGame() {
                // Start spawning words
                setInterval(() => {
                    this.spawnWord();
                }, 2000);

                // Start game loop
                this.gameLoop();
            }

            spawnWord() {
                if (this.activeWords.length < 5) {
                    const word = this.words[Math.floor(Math.random() * this.words.length)];
                    const x = Math.random() * (this.canvas.width - 100);
                    const y = 50;
                    
                    this.activeWords.push({
                        text: word,
                        x: x,
                        y: y,
                        speed: 0.5 + Math.random() * 0.5
                    });
                }
            }

            gameLoop() {
                // Update word positions
                for (let i = this.activeWords.length - 1; i >= 0; i--) {
                    const word = this.activeWords[i];
                    word.y += word.speed;
                    
                    // Remove words that go off screen
                    if (word.y > this.canvas.height) {
                        this.activeWords.splice(i, 1);
                        this.lives--;
                        this.updateStats();
                        this.updateDebugInfo(`Missed: ${word.text} (-1 life)`);
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                            return;
                        }
                    }
                }
                
                this.render();
                requestAnimationFrame(() => this.gameLoop());
            }

            render() {
                // Clear canvas
                this.ctx.fillStyle = 'rgba(10, 0, 0, 0.95)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw active words
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'left';
                
                this.activeWords.forEach(word => {
                    this.ctx.fillStyle = '#ff0000';
                    this.ctx.fillText(word.text, word.x, word.y);
                });
                
                // Draw typed text
                if (this.typedText.length > 0) {
                    this.ctx.fillStyle = '#00ff00';
                    this.ctx.font = '24px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(this.typedText, this.canvas.width / 2, this.canvas.height - 50);
                }
                
                // Draw instructions
                this.ctx.fillStyle = '#888';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Type the words to shoot them!', this.canvas.width / 2, 30);
            }

            gameOver() {
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.ctx.fillStyle = '#ff0000';
                this.ctx.font = '32px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('GAME OVER', this.canvas.width / 2, this.canvas.height / 2 - 20);
                
                this.ctx.fillStyle = '#fff';
                this.ctx.font = '20px Arial';
                this.ctx.fillText(`Final Score: ${this.score}`, this.canvas.width / 2, this.canvas.height / 2 + 20);
                
                this.updateDebugInfo('Game Over - Tap to restart');
                
                // Restart on tap
                this.canvas.addEventListener('click', () => {
                    location.reload();
                }, { once: true });
            }

            updateStats() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
                document.getElementById('lives').textContent = this.lives;
            }

            updateDebugInfo(message) {
                this.debugInfo.textContent = message;
                console.log('ðŸ“± Debug:', message);
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('ðŸš€ Mobile Test Loading...');
            
            // Small delay to ensure everything is ready
            setTimeout(() => {
                const game = new MobileGameTest();
                
                // Trigger mobile keyboard if on mobile
                if (game.isMobile) {
                    console.log('ðŸ“± Mobile device detected, triggering keyboard...');
                    setTimeout(() => {
                        game.keyboardTrigger.focus();
                        game.keyboardTrigger.click();
                    }, 1000);
                }
            }, 500);
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            location.reload();
        });
    </script>
</body>
</html>
